(function(){var a={};if(typeof Object.extend==="undefined"){a.extend=function(d,f){for(var e in f){if(f.hasOwnProperty(e)){d[e]=f[e]}}return d}}else{a.extend=Object.extend}function c(e,d){this.target=e;if(S(this.target).length==0){return{}}this.attr=d||{};this.bins=[];this.events={resize:""};this.attr.units=(typeof this.attr.units==="undefined")?"":this.attr.units;this.attr.formatKey=(typeof this.attr.formatKey==="undefined")?function(g){return g}:this.attr.formatKey;this.parent=(typeof this.attr.parent==="undefined")?this:this.attr.parent;this.max=this.attr.max;this.min=this.attr.min;this.inc=this.attr.inc;var f=this;this.bin=(typeof this.attr.bin==="function")?function(g){return this.attr.bin(g)}:function(g){return Math.floor((g-this.min)/this.inc)};return this}c.prototype.isSelected=function(d){b=this.bin(d);return(typeof this.bins[b].selected==="boolean")?this.bins[b].selected:true};c.prototype.toggleBin=function(d){key=this.bins[d].key;var e=this.target.substr(1)+"-bar-"+key.replace(/ /g,"-");this.bins[d].selected=!this.bins[d].selected;S("#"+e+"").toggleClass("deselected");return this};c.prototype.setBins=function(j,n){this.bins=[];if(!n){n={}}if(j&&j.length>0){this.data=j}else{if(j){n=j}}if(typeof this.data[0][0]==="string"){var l=0;var k={};for(var d=0;d<this.data.length;d++){if(!k[this.data[d][0]]){k[this.data[d][0]]=l;l++}p=k[this.data[d][0]];if(!this.bins[p]){this.bins[p]={value:0,key:this.data[d][0],selected:true}}this.bins[p].value+=this.data[d][1]}}else{var q=1e+100;var m=-1e+100;var g={};for(var i=0;i<this.data.length;i++){if(this.data[i][0]<q){q=this.data[i][0]}if(this.data[i][0]>m){m=this.data[i][0]}}if(n.inc){g.max=(n.max)?n.max:m;g.min=(n.min)?n.min:q;g.inc=n.inc}else{g=this.getGrid(q,m,n.mintick)}g.range=g.max-g.min+1;g.bins=Math.ceil(g.range/g.inc);if(this.inc&&g.inc!=this.inc){this.drawn=false}this.max=g.max;this.min=g.min;this.inc=g.inc;for(var p=0;p<g.bins;p++){this.bins[p]={value:0,key:""+(g.min+p*g.inc),selected:true}}for(var d=0;d<this.data.length;d++){p=this.bin(this.data[d][0]);this.bins[p].value+=this.data[d][1]}}return this};c.prototype.draw=function(){var f=this.target.substr(1);if(!this.target||!this.bins){return this}var t=0;var k=this.bins.length;if(k>0){if(S(this.target+" .label").length==0){S(this.target).append('<span class="label">label</span>')}var u=S(this.target).find(".label")[0].offsetHeight;if(!this.height){this.height=S(this.target)[0].offsetHeight||200}h=this.height-u;for(var r=0;r<this.bins.length;r++){if(this.bins[r].value>t){t=this.bins[r].value}}if(typeof this.drawn==="undefined"){this.drawn=false}if(!this.drawn){S(this.target).addClass("barchart").html('<div class="grid" style="height:'+(h)+'px;"></div><table style="height:'+this.height+'px"><tr style="vertical-align:bottom;"></tr></table><div style="clear:both;"></div>')}var d=this.getGrid(0,t);var i="";for(var m=0;m<=d.max;m+=d.inc){i+='<div class="line" style="bottom:'+(h*m/t)+'px;"><span>'+(this.attr.units||"")+this.formatNumber(m)+"</span></div>"}S(this.target+" .grid").html(i);var q=(S(this.target+" table td").length==0);i="";for(var r=0;r<this.bins.length;r++){var s=this.bins[r].key;var l=(t>0?(h*this.bins[r].value/t).toFixed(1):0);var o=Math.round(h-l);var n=h-o;if(n<1){o--}var j=f+"-bar-"+s.replace(/ /g,"-");if(q){i+='<td id="'+j+'" style="width:'+(100/k).toFixed(3)+'%;" data-index="'+r+'"><div class="antibar" style="height:'+o+'px;"></div><div class="bar'+(!this.bins[r].selected?" deselected":"")+'" title="'+s+": "+(this.attr.units||"")+this.formatNumber(this.bins[r].value)+'" style="height:'+n+'px;"></div>'+(((typeof s==="string"&&s.indexOf("-01"))||s.indexOf("-")==-1)?'<span class="label">'+this.attr.formatKey.call(this,s)+"</span>":"")+"</td>"}else{var e=S("#"+j+"");e.find(".bar").css({height:n+"px"}).toggleClass((!this.bins[r].selected?" deselected":"")).attr("title",s+": "+(this.attr.units||"")+this.formatNumber(this.bins[r].value));e.find(".antibar").css({height:o+"px"})}}if(q){S(this.target+" table tr").html(i)}if(!this.drawn){S(this.target+" .bar").parent().on("click",{me:this,parent:this.attr.parent},function(g){g.data.me.trigger("barclick",{event:g})}).on("mouseover",{me:this,parent:this.attr.parent},function(g){g.data.me.trigger("barover",{event:g})})}this.drawn=true}return this};c.prototype.on=function(f,g,d){if(typeof f!="string"){return this}if(typeof d=="undefined"){d=g;g={}}else{g={data:g}}if(typeof g!="object"||typeof d!="function"){return this}if(this.events[f]){this.events[f].push({e:g,fn:d})}else{this.events[f]=[{e:g,fn:d}]}return this};c.prototype.off=function(d){if(typeof d!="string"){return this}if(typeof this.events[d]=="object"){this.events[d]=[]}return this};c.prototype.trigger=function(g,d){if(typeof g!="string"){return}if(typeof d!="object"){d={}}var k=[];if(typeof this.events[g]=="object"){for(var f=0;f<this.events[g].length;f++){var j=a.extend(this.events[g][f].e,d);if(typeof this.events[g][f].fn=="function"){k.push(this.events[g][f].fn.call(this,j))}}}if(k.length>0){return k}};c.prototype.getGrid=function(f,l,e){var n=l-f;var d=10;if(!e){e=3}var g=Math.pow(d,Math.floor(Math.log(n)/Math.log(d)));g*=2;var m=(Math.floor(l/g))*g;if(m<l){m+=g}var k=m;var j=0;do{j++;k-=g}while(k>f);if(Math.abs(k)<1e-15){k=0}while(j<e){g/=2;if((k+g)<=f){k+=g}if((m-g)>=l){m-=g}j=j*2}if(m>l){m-=g}return{min:k,max:m,inc:g,range:m-k}};c.prototype.formatNumber=function(d){if(typeof d!=="number"){return d}if(d>=10000000){return Math.round(d/1000000)+"M"}if(d>=1000000){return(d/1000000).toFixed(1)+"M"}if(d>=100000){return Math.round(d/1000)+"k"}if(d>=10000){return Math.round(d/1000)+"k"}return(""+d).replace(/0{5,}1$/,"")};S.barchart=function(f,e,d){return new c(f,e,d)}})(S);